# Vulnerability Management Procedure

**Document Type**: Operational Runbook  
**Version**: 1.0.0  
**Last Updated**: 2026-02-14  
**Owner**: Security Team + DevSecOps  
**Related Policy**: [Security Policy](../policies/security-policy.md)

This runbook defines the process for identifying, assessing, prioritizing, and remediating security vulnerabilities in ClawdBot/OpenClaw deployments.

---

## Table of Contents

1. [Overview](#overview)
2. [Vulnerability Sources](#vulnerability-sources)
3. [Scanning Procedures](#scanning-procedures)
4. [Risk Assessment](#risk-assessment)
5. [Remediation Workflow](#remediation-workflow)
6. [Reporting](#reporting)
7. [Tools and Scripts](#tools-and-scripts)

---

## Overview

### Objectives

- **Identify** vulnerabilities before attackers exploit them
- **Prioritize** remediation based on risk (severity Ã— exploitability Ã— exposure)
- **Remediate** within SLA targets (P0: 24 hours, P1: 7 days, P2: 30 days, P3: 90 days)
- **Track** vulnerability metrics for continuous improvement

### Scope

**In Scope**:
- Container images (openclaw/clawdbot, custom images)
- Base operating systems (Docker hosts)
- Third-party dependencies (Python packages, npm modules)
- Infrastructure (Kubernetes, Docker Compose)
- Network services (MCP servers, gateways)
- Skills and tools (see [Supply Chain Security](../guides/05-supply-chain-security.md))

**Out of Scope**:
- Anthropic Claude API (vendor responsibility)
- Cloud provider infrastructure (AWS, Azure, GCP - vendor responsibility)
- Third-party SaaS integrations (assessed separately)

---

## Vulnerability Sources

### 1. Automated Scanning

**Container Images** (daily):
```bash
# Trivy scan (SBOM + vulnerabilities)
./scripts/supply-chain/scan-containers.sh \
  --image openclaw/clawdbot:latest \
  --output report.json

# Expected output: Critical/High/Medium/Low counts
```

**Dependencies** (weekly):
```bash
# Python dependencies
pip-audit --format json > pip-audit.json

# Node dependencies
npm audit --json > npm-audit.json

# Generate SBOM
syft openclaw/clawdbot:latest -o cyclonedx-json > sbom.json
```

**Infrastructure** (monthly):
```bash
# Docker host OS scan
./scripts/vulnerability-scanning/os-scan.sh --host docker-host-01

# Kubernetes security scan
kube-bench run --targets master,node,etcd,policies
```

---

### 2. Threat Intelligence

**Sources**:
- **CVE Database**: https://cve.mitre.org/ (public vulnerabilities)
- **NVD**: https://nvd.nist.gov/ (CVSS scores, exploit availability)
- **GitHub Security Advisories**: https://github.com/advisories (dependency vulnerabilities)
- **Vendor Security Bulletins**: Anthropic, Docker, Kubernetes
- **Threat Feeds**: AlienVault OTX, CISA KEV (Known Exploited Vulnerabilities)

**Monitoring**:
```bash
# Subscribe to vulnerability notifications
./scripts/vulnerability-scanning/subscribe-alerts.sh \
  --packages "anthropic-sdk,docker,kubernetes" \
  --severity critical,high
```

---

### 3. Security Audits

**Internal Audits** (quarterly):
- Full security scan (see [verify_openclaw_security.sh](../../scripts/verification/verify_openclaw_security.sh))
- Configuration review (drift from baseline)
- Access review (see [Access Review Procedure](./access-review.md))

**External Audits** (annually):
- Third-party penetration testing
- SOC 2 Type II audit
- ISO 27001 certification audit

---

### 4. Bug Bounty / Responsible Disclosure

**Public Disclosure**:
- Email: security@company.com
- Expected response time: 48 hours
- Vulnerability reward program (if applicable)

**Processing**:
1. Acknowledge receipt within 48 hours
2. Triage severity (see [Risk Assessment](#risk-assessment))
3. Remediate per SLA (see [Remediation Workflow](#remediation-workflow))
4. Credit researcher (with permission) in security advisory

---

## Scanning Procedures

### Daily: Container Image Scan

**Automated (CI/CD Pipeline)**:
```yaml
# .github/workflows/security-scan.yml
name: Security Scan
on:
  push:
    branches: [main]
  schedule:
    - cron: '0 2 * * *'  # Daily at 2 AM UTC

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Scan with Trivy
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: 'openclaw/clawdbot:${{ github.sha }}'
          format: 'sarif'
          output: 'trivy-results.sarif'
      - name: Upload to GitHub Security
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: 'trivy-results.sarif'
      - name: Fail on critical
        run: |
          CRITICAL=$(jq '.runs[0].results | map(select(.level=="error")) | length' trivy-results.sarif)
          if [ $CRITICAL -gt 0 ]; then exit 1; fi
```

**Manual (Production Images)**:
```bash
# Scan all production images
for image in $(docker images --filter "reference=openclaw/*" --format "{{.Repository}}:{{.Tag}}"); do
  echo "Scanning: $image"
  trivy image \
    --severity CRITICAL,HIGH \
    --exit-code 1 \
    --no-progress \
    "$image"
done
```

---

### Weekly: Dependency Scan

```bash
# Full dependency audit
./scripts/supply-chain/dependency-audit.sh \
  --format html \
  --output weekly-dependency-report.html

# Email report to Security team
mail -s "Weekly Dependency Vulnerability Report" \
  -A weekly-dependency-report.html \
  security@company.com < /dev/null
```

---

### Monthly: Infrastructure Scan

```bash
# Full security verification
./scripts/verification/verify_openclaw_security.sh \
  --output monthly-security-report.pdf

# Docker host vulnerability scan
nmap -sV --script vuln docker-host-01.internal

# Kubernetes CIS Benchmark
kube-bench run --targets master,node,etcd,policies \
  > kube-bench-report.txt
```

---

## Risk Assessment

### Scoring Matrix

**Risk Score = Severity Ã— Exploitability Ã— Exposure**

#### Severity (CVSS Base Score)

| CVSS Score | Severity | Priority |
|------------|----------|----------|
| 9.0 - 10.0 | Critical | P0 |
| 7.0 - 8.9 | High | P1 |
| 4.0 - 6.9 | Medium | P2 |
| 0.1 - 3.9 | Low | P3 |

#### Exploitability

| Factor | Score |
|--------|-------|
| Public exploit available (Metasploit, ExploitDB) | 3Ã— |
| Proof-of-concept exploit published | 2Ã— |
| Exploit complexity: Low (CVSS AC:L) | 1.5Ã— |
| No known exploit | 1Ã— |

#### Exposure

| Factor | Score |
|--------|-------|
| Internet-facing service | 3Ã— |
| Internal service (VPN-protected) | 2Ã— |
| Localhost-only service | 1Ã— |
| Not deployed (in codebase only) | 0.5Ã— |

### Example

**Vulnerability**: CVE-2024-12345 - Remote Code Execution in Docker
- CVSS Score: 9.8 (Critical)
- Public exploit in Metasploit (3Ã—)
- Internet-facing Docker API exposed (3Ã—)

**Risk Score**: 9.8 Ã— 3 Ã— 3 = **88.2 (P0 - Emergency)**

---

### Prioritization

**P0 - Emergency** (Fix within 24 hours):
- Critical severity (CVSS 9.0+)
- Active exploitation in the wild (CISA KEV)
- Internet-facing services affected
- Credential theft or data exfiltration possible

**P1 - Urgent** (Fix within 7 days):
- High severity (CVSS 7.0-8.9)
- Public exploit available
- Internal services affected (but VPN-protected)
- Privilege escalation or DoS possible

**P2 - Normal** (Fix within 30 days):
- Medium severity (CVSS 4.0-6.9)
- No public exploit (proof-of-concept only)
- Requires authentication or local access
- Information disclosure or minor impact

**P3 - Low** (Fix within 90 days):
- Low severity (CVSS 0.1-3.9)
- Theoretical vulnerability (no exploit)
- Defense-in-depth improvement
- Best practice recommendation

---

## Remediation Workflow

### Step 1: Ticket Creation

```bash
# Create JIRA ticket from scan results
./scripts/vulnerability-scanning/create-tickets.py \
  --scan-report trivy-results.json \
  --min-severity high

# Example ticket:
# VULN-2026-042: [CRITICAL] RCE in urllib3 < 2.0.7 (CVE-2024-12345)
# Assignee: DevSecOps
# Priority: P0
# SLA: 24 hours
```

---

### Step 2: Analysis

**Questions to Answer**:
1. Is this vulnerability applicable to our deployment? (Check if affected code path is used)
2. Are compensating controls in place? (E.g., network segmentation, WAF rules)
3. What is the impact if exploited? (See [Threat Model](../architecture/threat-model.md))
4. Can we mitigate without patching? (Firewall block, config change)

**Analysis Script**:
```bash
# Check if vulnerability applies
./scripts/vulnerability-scanning/check-applicability.py \
  --cve CVE-2024-12345 \
  --deployment openclaw-production

# Output:
# âœ… Affected code path is used (urllib3.request() called in mcp-client.py)
# âš ï¸ Compensating control: Network segmentation (internal only)
# ðŸ”´ Recommend: Patch urgently (P0)
```

---

### Step 3: Remediation Options

**Option 1: Upgrade Dependency** (preferred):
```bash
# Update vulnerable package
pip install --upgrade urllib3>=2.0.7

# Test in staging
./scripts/testing/run-integration-tests.sh --env staging

# Deploy to production
./scripts/deployment/deploy.sh --env production
```

**Option 2: Apply Patch**:
```bash
# Apply vendor-provided patch
patch -p1 < urllib3-CVE-2024-12345.patch

# Rebuild container
docker build -t openclaw/clawdbot:1.2.3-patched .
```

**Option 3: Workaround** (temporary):
```bash
# Disable vulnerable feature
export URLLIB_DISABLE_SSL_VERIFICATION=false

# Add firewall rule
iptables -A INPUT -p tcp --dport 443 -m string --string "exploit-payload" -j DROP
```

**Option 4: Accept Risk** (requires CISO approval):
```markdown
# Risk Acceptance Form

**Vulnerability**: CVE-2024-12345
**Justification**: Upgrade breaks compatibility with legacy system X; compensating controls in place (network segmentation, IDS monitoring)
**Residual Risk**: Medium (CVSS 6.5 after mitigation)
**Approval**: CISO signature required
**Review Date**: 2026-05-14 (90 days)
```

---

### Step 4: Verification

**Rescan After Remediation**:
```bash
# Rescan container image
trivy image openclaw/clawdbot:1.2.3-patched \
  --severity CRITICAL,HIGH

# Expected output: CVE-2024-12345 no longer present
```

**Security Regression Test**:
```bash
# Run full security verification
./scripts/verification/verify_openclaw_security.sh

# Run vulnerability-specific test
./scripts/testing/exploit-tests/CVE-2024-12345-test.sh
# Expected: Test fails (exploit no longer works)
```

---

### Step 5: Close Ticket

```bash
# Update JIRA ticket
jira comment VULN-2026-042 \
  "Remediated via urllib3 upgrade to 2.0.7. Verified in production. Closing."

jira close VULN-2026-042 --resolution Fixed
```

---

## Reporting

### Daily Dashboard

**Metrics**:
- Total vulnerabilities by severity (Critical/High/Medium/Low)
- Open vs closed vulnerabilities
- Average time to remediate (MTTR)
- SLA compliance (%)

**Tool**: Grafana dashboard (see [monitoring-stack.yml](../../configs/examples/monitoring-stack.yml))

---

### Weekly Report

**To**: Security Team, DevSecOps, Engineering Leads  
**Format**: Email + PDF

**Contents**:
1. **Summary**: New vulnerabilities discovered, remediated, overdue
2. **Top 5 Critical Findings**: With remediation plans
3. **Trend Analysis**: Are we improving? (Fewer vulns over time?)
4. **Action Items**: Overdue tickets, required approvals

**Generation**:
```bash
./scripts/vulnerability-scanning/generate-weekly-report.py \
  --format pdf \
  --output weekly-vuln-report.pdf

mail -s "Weekly Vulnerability Report" \
  -A weekly-vuln-report.pdf \
  security@company.com,devops@company.com < /dev/null
```

---

### Monthly Executive Report

**To**: CISO, CTO, CIO  
**Format**: PowerPoint presentation

**Contents**:
1. **Executive Summary**: One-page overview with key metrics
2. **Risk Posture**: Overall security posture trend (improving/declining)
3. **Compliance**: SOC 2, ISO 27001, GDPR compliance status
4. **Budget**: Costs of remediation, tools, external audits
5. **Recommendations**: Investments needed (tools, headcount)

**Metrics**:
- Mean Time To Detect (MTTD): How quickly do we find vulnerabilities?
- Mean Time To Remediate (MTTR): How quickly do we fix them?
- Vulnerability Density: Vulns per 1000 lines of code
- SLA Compliance: % of vulnerabilities fixed within SLA

---

## Tools and Scripts

### Scanning Tools

```bash
# Container image scanning
trivy image <image-name>
grype <image-name>

# Dependency scanning
pip-audit  # Python
npm audit  # Node.js
bundle audit  # Ruby

# Infrastructure scanning
./scripts/verification/verify_openclaw_security.sh
kube-bench  # Kubernetes CIS Benchmark
```

### Analysis Tools

```bash
# SBOM generation
syft <image-name> -o cyclonedx-json

# Vulnerability database lookup
nvd-lookup CVE-2024-12345

# Exploit availability check
searchsploit CVE-2024-12345
```

### Remediation Tools

```bash
# Automated patching (use with caution)
./scripts/vulnerability-scanning/auto-remediate.sh \
  --severity critical \
  --dry-run

# Dependency updates
./scripts/supply-chain/update-dependencies.sh \
  --security-only
```

---

**Document Owner**: Security Team + DevSecOps  
**Last Updated**: 2026-02-14  
**Next Review**: 2026-05-14 (quarterly)  
**Questions**: security@company.com  
**Tool Access**: See DevSecOps team for credentials
