# monitoring-stack.yml
# Prometheus + Grafana + Alertmanager configuration

# Prometheus configuration
prometheus:
  global:
    scrape_interval: 30s
    evaluation_interval: 30s

  alerting:
    alertmanagers:
      - static_configs:
          - targets:
              - alertmanager:9093

  rule_files:
    - /etc/prometheus/rules/*.yml

  scrape_configs:
    - job_name: 'clawdbot'
      static_configs:
        - targets: ['clawdbot:9090']
      metrics_path: /metrics

# Alertmanager configuration
alertmanager:
  global:
    resolve_timeout: 5m

  route:
    group_by: ['alertname', 'severity']
    group_wait: 10s
    group_interval: 10s
    repeat_interval: 1h
    receiver: 'default'
    routes:
      - match:
          severity: critical
        receiver: pagerduty
      - match:
          severity: warning
        receiver: slack

  receivers:
    - name: 'default'
      email_configs:
        - to: 'security@company.com'

    - name: 'pagerduty'
      pagerduty_configs:
        - service_key: 'YOUR_PAGERDUTY_KEY'

    - name: 'slack'
      slack_configs:
        - api_url: 'YOUR_SLACK_WEBHOOK'
          channel: '#security-alerts'
