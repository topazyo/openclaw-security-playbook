---
# Environment-Specific Configuration Overrides
# Merges with openclaw-agent.yml base configuration
#
# Usage: openclaw-agent --config openclaw-agent.yml --env <environment>
#        where <environment> is one of: development, staging, production
#
# Merge behavior:
#   - Scalar values: Override base config
#   - Arrays: Replace entire array (not append)
#   - Objects: Deep merge with base config
#
# Environment Selection:
#   - development: Local development, relaxed security
#   - staging: Pre-production testing, production-like security
#   - production: Live environment, maximum security
# ============================================================================
# DEVELOPMENT ENVIRONMENT
# ============================================================================
# Purpose: Local development and testing
# Security: RELAXED (not for production use)
# Characteristics:
#   - High rate limits for testing
#   - Debug logging enabled
#   - Self-signed certificates accepted
#   - No MFA required
#   - Shorter token expiry for testing
development:
  agent:
    name: "openclaw-agent-dev"
    environment: "development"
    capabilities:
      max_concurrent_tasks: 50  # Higher for load testing
      max_task_duration_seconds: 600  # 10 minutes for debugging
      memory_limit_mb: 4096  # More memory for profiling
      cpu_limit_cores: 4.0
  security_controls:
    # Relaxed rate limits for testing
    rate_limiting:
      enabled: true
      requests_per_minute: 1000  # 10x production limit
      burst_size: 200
      per_user_limits:
        requests_per_minute: 500
        burst_size: 100
      per_ip_limits:
        requests_per_minute: 2000
        burst_size: 400
    # Simplified authentication for dev
    authentication:
      method: "API_Key"  # Easier than mTLS for local dev
      mtls:
        enabled: false
      api_key:
        enabled: true
        header_name: "X-OpenClaw-API-Key"
        key_prefix: "oc_dev_"
        min_key_length: 16  # Shorter for dev convenience
      token_expiry_seconds: 7200  # 2 hours for dev sessions
      mfa_required: false  # Disabled for local dev
      max_concurrent_sessions: 10  # Multiple browser tabs
    # Dev logging configuration
    logging:
      level: "DEBUG"  # Verbose logging for troubleshooting
      redact_pii: false  # See actual data during dev
      tamper_evident: false  # Not needed for local dev
  # Local MCP server
  mcp_server:
    host: "localhost"
    port: 8443
    tls_config:
      enabled: true
      verify_certs: false  # Accept self-signed certs
      ca_cert_path: "/etc/openclaw/dev-ca.crt"
    connect_timeout_seconds: 30  # Longer for debugging
    request_timeout_seconds: 120
  # Local monitoring stack
  monitoring:
    elasticsearch:
      url: "http://localhost:9200"
      username: "elastic"
      password: "changeme"
      tls_enabled: false  # No TLS for local Elasticsearch
    prometheus:
      enabled: true
      port: 9091  # Non-standard port to avoid conflicts
    health_check:
      interval_seconds: 60  # Less frequent checks
    tracing:
      enabled: true  # Enable tracing for dev debugging
      provider: "jaeger"
      endpoint: "http://localhost:14268/api/traces"
      sample_rate: 1.0  # 100% sampling for dev
  # Development compliance settings
  compliance:
    soc2_enabled: false
    iso27001_enabled: false
    gdpr_enabled: false
    pci_dss_enabled: false
  # Permissive skill settings
  skills:
    auto_install: true  # Convenience for dev
    auto_update: true
    require_signature: false  # No signature verification in dev
    network_restrictions:
      allow_outbound: true  # Full internet access
      allowed_domains: []   # No restrictions
    filesystem_restrictions:
      read_only: false  # Read-write for dev
  # No backups in dev environment
  backup:
    enabled: false
  # Feature flags for dev
  feature_flags:
    experimental_features_enabled: true
    beta_features_enabled: true
    circuit_breaker:
      enabled: false  # Disable to test failure scenarios
---
# ============================================================================
# STAGING ENVIRONMENT
# ============================================================================
# Purpose: Pre-production testing and UAT
# Security: PRODUCTION-LIKE (mirrors production with minor relaxations)
# Characteristics:
#   - Production security controls enabled
#   - Separate staging infrastructure
#   - Testing-friendly timeouts
#   - Beta features enabled
staging:
  agent:
    name: "openclaw-agent-staging"
    environment: "staging"
    capabilities:
      max_concurrent_tasks: 20  # Higher than prod for load testing
      max_task_duration_seconds: 450  # Slightly longer for testing
      memory_limit_mb: 2560
      cpu_limit_cores: 2.5
  security_controls:
    # Slightly relaxed rate limits for testing
    rate_limiting:
      enabled: true
      requests_per_minute: 150  # 1.5x production
      burst_size: 30
      redis_url: ${REDIS_URL_STAGING}
      per_user_limits:
        requests_per_minute: 75
        burst_size: 15
      per_ip_limits:
        requests_per_minute: 300
        burst_size: 60
    # Production-like authentication
    authentication:
      method: "mTLS"
      mtls:
        enabled: true
        ca_cert_path: "/etc/openclaw/staging-ca.crt"
        client_cert_required: true
        verify_depth: 3
        crl_check: true
        crl_url: "https://ca-staging.openclaw.ai/crl"
      oauth2:
        enabled: true  # Test OAuth2 integration
        provider: "Auth0"
        client_id: ${OAUTH2_CLIENT_ID_STAGING}
        client_secret: ${OAUTH2_CLIENT_SECRET_STAGING}
        token_endpoint: "https://auth-staging.openclaw.ai/token"
        userinfo_endpoint: "https://auth-staging.openclaw.ai/userinfo"
        jwks_uri: "https://auth-staging.openclaw.ai/.well-known/jwks.json"
      token_expiry_seconds: 3600
      mfa_required: true  # Test MFA in staging
      max_concurrent_sessions: 3
    # Info-level logging (not debug)
    logging:
      level: "INFO"
      redact_pii: true  # Production-like PII handling
      tamper_evident: true
      retention_days: 365  # 1 year retention in staging
  # Staging MCP server
  mcp_server:
    host: ${MCP_SERVER_HOST_STAGING}
    port: 8443
    tls_config:
      enabled: true
      verify_certs: true  # Verify staging certs
      ca_cert_path: "/etc/openclaw/staging-ca.crt"
      client_cert_path: "/etc/openclaw/agent-staging.crt"
      client_key_path: "/etc/openclaw/agent-staging.key"
      min_version: "1.3"
    connect_timeout_seconds: 15  # Slightly longer for testing
    request_timeout_seconds: 45
  # Staging monitoring stack
  monitoring:
    elasticsearch:
      url: ${ELASTICSEARCH_URL_STAGING}
      username: ${ELASTICSEARCH_USERNAME}
      password: ${ELASTICSEARCH_PASSWORD}
      index_prefix: "openclaw-staging-logs-"
      tls_enabled: true
      verify_certs: true
    prometheus:
      enabled: true
      port: 9090
    health_check:
      interval_seconds: 30
    tracing:
      enabled: true  # Enabled for testing
      provider: "jaeger"
      endpoint: "http://jaeger-staging.openclaw.ai:14268/api/traces"
      sample_rate: 0.5  # 50% sampling
  # Staging compliance (mirrors production)
  compliance:
    soc2_enabled: true
    iso27001_enabled: true
    gdpr_enabled: true
    pci_dss_enabled: false
    soc2_controls:
      - "CC6.1"
      - "CC6.2"
      - "CC6.3"
      - "CC7.1"
      - "CC7.2"
      - "CC7.3"
    iso27001_controls:
      - "A.9.2.1"
      - "A.9.2.3"
      - "A.10.1.1"
      - "A.12.4.1"
      - "A.14.1.2"
      - "A.16.1.4"
  # Staging skill settings (production-like)
  skills:
    auto_install: false
    auto_update: false
    require_signature: true  # Test signature verification
    allowlist_path: "configs/skill-policies/allowlist-staging.json"
    network_restrictions:
      allow_outbound: false
      allowed_domains:
        - "api-staging.openclaw.ai"
        - "*.staging.openclaw.ai"
    filesystem_restrictions:
      read_only: true
  # Staging backups (shorter retention)
  backup:
    enabled: true
    schedule: "0 3 * * *"  # Daily 3 AM UTC
    retention_daily: 7
    retention_weekly: 2
    retention_monthly: 3
    storage:
      type: "s3"
      bucket: "openclaw-backups-staging"
      region: "us-east-1"
      encryption: "AES256"
      storage_class: "STANDARD_IA"  # Cheaper than Glacier
    verify_backups: true
    rto_hours: 8
    rpo_minutes: 30
  # Feature flags for staging
  feature_flags:
    experimental_features_enabled: false
    beta_features_enabled: true  # Test beta features
    circuit_breaker:
      enabled: true
      failure_threshold: 5
      timeout_seconds: 10
      reset_timeout_seconds: 60
---
# ============================================================================
# PRODUCTION ENVIRONMENT
# ============================================================================
# Purpose: Live production workloads
# Security: MAXIMUM (strictest security controls)
# Characteristics:
#   - Full compliance enabled (SOC 2, ISO 27001, GDPR)
#   - Strict rate limits
#   - MFA required
#   - Tamper-evident logging
#   - 7-year log retention
#   - Regular backups with 3-2-1 strategy
production:
  agent:
    name: "openclaw-agent-prod"
    environment: "production"
    capabilities:
      max_concurrent_tasks: 10  # Conservative for stability
      max_task_duration_seconds: 300  # 5 minutes
      memory_limit_mb: 2048
      cpu_limit_cores: 2.0
  security_controls:
    # Strict rate limits
    rate_limiting:
      enabled: true
      requests_per_minute: 100  # Base config value
      burst_size: 20
      redis_url: ${REDIS_URL_PROD}
      per_user_limits:
        requests_per_minute: 50
        burst_size: 10
      per_ip_limits:
        requests_per_minute: 200
        burst_size: 40
      http_status_code: 429
      retry_after_seconds: 60
    # Maximum authentication security
    authentication:
      method: "mTLS"  # Most secure method
      mtls:
        enabled: true
        ca_cert_path: "/etc/openclaw/prod-ca.crt"
        client_cert_required: true
        verify_depth: 3
        crl_check: true  # Always check certificate revocation
        crl_url: "https://ca.openclaw.ai/crl"
      token_expiry_seconds: 3600  # 1 hour
      refresh_token_expiry_seconds: 86400  # 24 hours
      mfa_required: true  # Mandatory MFA
      mfa_providers:
        - "totp"
        - "webauthn"
      mfa_grace_period_days: 0  # No grace period in prod
      max_concurrent_sessions: 3
      session_timeout_seconds: 3600
      idle_timeout_seconds: 1800  # 30 minutes idle timeout
    # Strict authorization
    authorization:
      enabled: true
      rbac_enabled: true
      default_role: "guest"  # Minimal privileges by default
      admin_roles:
        - "admin"
        - "security-ops"
        - "incident-response"
    # Production logging
    logging:
      level: "INFO"  # No debug logs in production
      format: "json"
      retention_days: 2555  # 7 years for SOC 2
      index_pattern: "openclaw-logs-*"
      redact_pii: true  # Always redact PII
      redact_patterns:
        - "ssn"
        - "credit_card"
        - "email"
        - "api_key"
        - "password"
        - "phone_number"
        - "ip_address"
      tamper_evident: true  # SHA-256 hash chains
      hash_algorithm: "SHA-256"
      log_authentication: true
      log_authorization: true
      log_data_access: true
      log_configuration_changes: true
      log_errors: true
  # Production MCP server
  mcp_server:
    host: ${MCP_SERVER_HOST_PROD}
    port: 8443
    tls_config:
      enabled: true
      verify_certs: true  # Strict certificate validation
      ca_cert_path: "/etc/openclaw/prod-ca.crt"
      client_cert_path: "/etc/openclaw/agent-prod.crt"
      client_key_path: "/etc/openclaw/agent-prod.key"
      min_version: "1.3"  # TLS 1.3 only
      max_version: "1.3"
    connect_timeout_seconds: 10
    request_timeout_seconds: 30
    max_connections: 100
    keepalive_enabled: true
    keepalive_interval_seconds: 60
    retry_enabled: true
    retry_max_attempts: 3
    retry_backoff_seconds: 1
  # Production monitoring
  monitoring:
    elasticsearch:
      url: ${ELASTICSEARCH_URL_PROD}
      username: ${ELASTICSEARCH_USERNAME}
      password: ${ELASTICSEARCH_PASSWORD}
      index_prefix: "openclaw-logs-"
      bulk_size: 100
      bulk_flush_interval_seconds: 5
      tls_enabled: true
      verify_certs: true
      ca_cert_path: "/etc/openclaw/prod-ca.crt"
    prometheus:
      enabled: true
      port: 9090
      path: "/metrics"
      metrics:
        - "http_requests_total"
        - "http_request_duration_seconds"
        - "http_request_size_bytes"
        - "http_response_size_bytes"
        - "authentication_attempts_total"
        - "authentication_failures_total"
        - "rate_limit_exceeded_total"
        - "encryption_operations_total"
        - "encryption_operation_duration_seconds"
    health_check:
      enabled: true
      port: 8080
      path: "/health"
      interval_seconds: 30
    tracing:
      enabled: false  # Disabled in prod (performance overhead)
      sample_rate: 0.01  # 1% if enabled
  # Full compliance in production
  compliance:
    soc2_enabled: true
    iso27001_enabled: true
    gdpr_enabled: true
    pci_dss_enabled: false  # Enable if processing payments
    soc2_controls:
      - "CC6.1"  #  Logical and physical access controls
      - "CC6.2"  #  Authentication and authorization
      - "CC6.3"  #  Privileged access management
      - "CC7.1"  #  Threat detection and monitoring
      - "CC7.2"  #  Event logging and analysis
      - "CC7.3"  #  Incident response
    iso27001_controls:
      - "A.9.2.1"   #  User registration and de-registration
      - "A.9.2.3"   #  Management of privileged access rights
      - "A.10.1.1"  #  Cryptographic controls
      - "A.12.4.1"  #  Event logging
      - "A.14.1.2"  #  Securing application services
      - "A.16.1.4"  #  Assessment of information security events
    gdpr_settings:
      data_retention_days: 2555  # 7 years
      right_to_erasure: true
      data_portability: true
      breach_notification_hours: 72  # Article 33
      consent_required: true
  # Strict skill security in production
  skills:
    auto_install: false  # Never auto-install in prod
    auto_update: false   # Never auto-update in prod
    require_signature: true  # Always verify signatures
    allowlist_path: "configs/skill-policies/allowlist.json"
    dangerous_patterns_path: "configs/skill-policies/dangerous-patterns.json"
    max_execution_time_seconds: 60
    max_memory_mb: 512
    max_cpu_percent: 50
    network_restrictions:
      allow_outbound: false
      allowed_domains:
        - "api.openclaw.ai"
        - "*.openclaw.ai"
      blocked_ports:
        - 22    #  SSH
        - 3306  #  MySQL
        - 5432  #  PostgreSQL
        - 6379  #  Redis
        - 27017  #  MongoDB
    filesystem_restrictions:
      read_only: true
      allowed_paths:
        - "/tmp/openclaw/skills"
        - "/var/openclaw/data"
      blocked_paths:
        - "/etc"
        - "/root"
        - "/home"
        - "/var/log"
  # Production backup configuration
  backup:
    enabled: true
    schedule: "0 2 * * *"  # Daily 2 AM UTC
    retention_daily: 7     # 7 daily backups
    retention_weekly: 4    # 4 weekly backups
    retention_monthly: 12  # 12 monthly backups (1 year)
    storage:
      type: "s3"
      bucket: "openclaw-backups-prod"
      region: "us-east-1"
      encryption: "AES256"
      storage_class: "GLACIER"  # Long-term archival
      versioning: true
      object_lock: true  # WORM (Write Once Read Many)
    verify_backups: true
    verify_schedule: "0 3 * * 0"  # Weekly Sunday 3 AM UTC
    rto_hours: 4   # 4-hour recovery time objective
    rpo_minutes: 15  # 15-minute recovery point objective
  # Conservative feature flags in production
  feature_flags:
    experimental_features_enabled: false  # Never in prod
    beta_features_enabled: false          # Only after staging validation
    circuit_breaker:
      enabled: true  # Always protect against cascading failures
      failure_threshold: 5
      timeout_seconds: 10
      reset_timeout_seconds: 60
